!function(a,b,c){"use strict";b.module("ngRestfulCollection",[]).provider("$collection",function(){var a=this.defaults={preRequest:null,relsKey:null,collectionKey:"data",idKey:"id"};this.$get=["$q","$http","$filter","$cacheFactory","$injector","$rootScope","$resourceLibrary",function(c,d,e,f,g,h,i){function j(a,c){this._meta={type:a,url:i.get(a),params:b.copy(c)},this.data={collection:[]}}function k(a){return c.reject(a)}function l(a,b){return a+"/"+b}function m(a,c){var d=n(a,c[r.idKey]);d?b.extend(d,c):a.push(c)}function n(a,b){for(var c=r.idKey,d=0,e=a.length;e>d;d++)if(a[d][c]===b)return a[d];return null}function o(a){var c="";return b.forEach(a[1],function(a,b){c+=b+a}),a[0]+c}function p(a,b){var c=o(arguments),d=q.get(c);if(d)return d;var e=new j(a,b);return q.put(c,e),e}var q=f("ng-restful-collection"),r=b.copy(a),s=s?g.get(s):{run:function(){return c.when(!0)}};return j.prototype.get=function(a){var e=this,f=b.copy(a||{}),g=!!f[r.idKey],h=e._meta.url;if(g){var j=n(e.data.collection,f[r.idKey]);if(j)return c.resolve(b.copy(j));h=l(e._meta.url,f[r.idKey]),delete f[r.idKey]}else b.extend(f,e._meta.params);return s.run().then(function(){return d.get(h,{params:f})},k).then(function(a){var c,d=a.data;if(g)m(e.data.collection,d),i.extend(d[r.relsKey],e._meta.type+"["+d[r.idKey]+"]"),c=b.copy(d);else{for(var f=d[r.collectionKey],h=0,j=f.length;j>h;h++){var k=f[h];m(e.data.collection,k),i.extend(k[r.relsKey],e._meta.type+"["+k[r.idKey]+"]")}c=b.copy(e.data.collection)}return c},k)},j.prototype.save=function(a){var c=this,e=a[r.idKey]?l(c._meta.url,a[r.idKey]):c._meta.url;return s.run().then(function(){var b=a[r.idKey]?"put":"post";return d[b](e,a)},k).then(function(d){return a=d.data,m(c.data.collection,a),i.extend(a[r.relsKey],c._meta.type+"["+a[r.idKey]+"]"),b.copy(a)},k)},j.prototype.remove=function(a){var b=this,c=a[r.idKey];return s.run().then(function(){return d["delete"](l(b._meta.url,a[r.idKey]))},k).then(function(){var a=n(b.data.collection,c),d=b.data.collection.indexOf(a),e=i.getAll(b._meta.type+"["+c+"]");b.data.collection.splice(d,1);for(var f=0,g=e.length;g>f;f++)$collection(e[f]).clearLocal()},k)},j.prototype.clearLocal=function(){var a=this;a.data.collection=[],h.$emit("$collection:clear-local",a)},p}]}).provider("$resourceLibrary",function(){var a=this.defaults={baseLinks:{}};this.$get=function(){function c(a,c){c=c?c+".":"",b.isArray(a)?b.forEach(a,function(a){g[c+a.rel]=a.uri}):b.isObject(a)&&b.forEach(a,function(a,b){g[c+b]=a})}function d(a){return g[a]}function e(a){var c,e=Object.keys(g),f=[];if(b.isString(a))return[d(a)];b.isFunction(a)?c=a:b.isFunction(a.test)&&(c=function(b){return a.test(b)});for(var h=0,i=e.length;i>h;h++)c(e[h])&&f.push(g[e[h]]);return f}var f=b.copy(a),g={};return c(f.baseLinks),{extend:c,get:d,getAll:e}}}).controller("ngRestfulCollectionCtrl",["$scope","$attrs","$parse","$collection",function(a,c,d,e){function f(a){return a.replace(/\./g," ").replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(a,b){return 0===b?a.toLowerCase():a.toUpperCase()})}function g(a){return function(b){a&&a(b)}}var h=d(c.ngRestfulCollection)(a);a.getEditCopy=b.copy,b.forEach(h,function(c){var d=e(c.type,c.params),h=f(c.type);a[h]=b.extend({data:d.data,save:function(a,b,c){return d.save(a).then(g(b),g(c))},remove:function(a,b,c){return d.remove(a).then(g(b),g(c))},refresh:function(a,b){return d.clearLocal(),d.get().then(g(a),g(b))}},a[h]),d.get()})}]).directive("ngRestfulCollection",function(){return{restrict:"A",controller:"ngRestfulCollectionCtrl"}})}(window,angular);
//# sourceMappingURL=ng-restful-collection.min.map