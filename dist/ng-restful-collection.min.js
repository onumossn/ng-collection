!function(a,b,c){"use strict";b.module("ngRestfulCollection",[]).provider("$collection",function(){var a=this.defaults={collectionKey:"data",idKey:"id"};this.$get=["$q","$http","$filter","$cacheFactory","$injector","$rootScope","$resourceLibrary",function(c,d,e,f,g,h,i){function j(c,d,e){var g;this._meta=b.extend({},a,i.getConfig(c),{type:c,params:b.copy(d)},e),this._meta.configs=this._meta.configs||{},e&&e.cache&&(this._meta.cache=f(e.cache.name||b.toJson(this._meta),e.cache)),g=b.isFunction(this._meta.sharedType)?this._meta.sharedType(e):g||c,p[g]||(p[g]=[]),p[g].push(this),this._meta.instances=p[g],this.data={collection:[]}}function k(a){return c.reject(a)}function l(a,b){return a+"/"+b}function m(a,b){var c={};return c[a]=b,c}function n(a){var c=a[0];return a[1]&&(c+=b.toJson(a[1])),a[2]&&(c+=b.toJson(a[2])),c}var o=f("ng-restful-collection"),p={};return j.prototype.get=function(a,e,f){var g,h,i=this,j=b.copy(a||{}),m=!!j[i._meta.idKey],n=i._meta.getURI(i._meta,j),o=e?null:this._meta.cache;if(m){var p=i._findById(j[i._meta.idKey]);if(p)return c.resolve(p);n=l(n,j[i._meta.idKey]),delete j[i._meta.idKey]}else b.extend(j,i._meta.params);return h=b.extend({params:j},i._meta.configs.get),o&&(g=c.resolve(o.get(n+b.toJson(h))))?g:d.get(n,h).then(function(a){var c,d=a.data;return m?(i._insertIntoCollection(d),c=d):f?c=d[i._meta.collectionKey]:(i.data.collection=d[i._meta.collectionKey]||[],c=i.data.collection),c=b.copy(c),o&&!m&&o.put(n+b.toJson(h),c),c},k)},j.prototype.save=function(a){var c,e=this,f=e._meta.getURI(e._meta,{},a);return a[e._meta.idKey]&&(f=l(f,a[e._meta.idKey])),c=a[e._meta.idKey]?"put":"post",d[c](f,a,e._meta.configs[c]).then(function(c){var d=e._insertIntoCollection(c.data);return h.$emit("collection:save",e,d["new"],d.original||{},a,e._meta.instances),b.copy(c.data)},k)},j.prototype.remove=function(a){var b=this,c=b._meta.getURI(b._meta,{},a);return d["delete"](l(c,a[b._meta.idKey]),b._meta.configs["delete"]).then(function(){b._removeFromCollection(a)},k)},j.prototype.clearLocal=function(){var a=this;a.data.collection=[],h.$emit("$collection:clear-local",a)},j.prototype._removeFromCollection=function(a){var b=this._findById(a[this._meta.idKey]),c=this.data.collection.indexOf(b);return this.data.collection.splice(c,1),a},j.prototype._insertIntoCollection=function(a){var c=this,d=c._findById(a[c._meta.idKey]),e=b.copy(d);return d?a=b.extend(d,a):c.data.collection.push(a),{original:e,"new":a}},j.prototype._findById=function(a){var b=this;return e("filter")(b.data.collection,m(b._meta.idKey,a))[0]},function(a,b,c){var d=n(arguments),e=o.get(d);if(e)return e;var f=new j(a,b,c);return o.put(d,f),f}}]}).provider("$resourceLibrary",function(){var a=this.defaults={baseLinks:{}};this.$get=["$cacheFactory",function(c){function d(a,c){c=c?c+".":"",b.isArray(a)?b.forEach(a,function(a){g.put(c+a.rel,e(a))}):b.isObject(a)&&b.forEach(a,function(a,b){g.put(c+b,e(a))})}function e(a){return b.isString(a)&&(a={uri:a}),a.configs&&a.configs.common&&b.forEach(a.configs,function(c,d){a.configs[d]=b.extend({},a.configs.common,c)}),a.getURI=b.isFunction(a.uri)?a.uri:function(){return a.uri},a}var f=b.copy(a),g=c("resource-library");return d(f.baseLinks),{extend:d,get:function(){return g.get.apply(this,arguments).uri},getConfig:g.get}}]}).controller("ngRestfulCollectionCtrl",["$scope","$attrs","$parse","$collection",function(a,c,d,e){function f(a){return a.replace(/\./g," ").replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(a,b){return 0===b?a.toLowerCase():a.toUpperCase()})}function g(a){return function(c){b.isFunction(a)&&a(c)}}var h=d(c.ngRestfulCollection)(a);a.getEditCopy=b.copy,b.forEach(h,function(c){var d=e(c.type,c.params,c.option),h=f(c.type);a[h]=b.extend({data:d.data,save:function(a,b,c){return d.save(a).then(g(b),g(c))},remove:function(a,b,c){return d.remove(a).then(g(b),g(c))},refresh:function(a,b,c){return c&&d.clearLocal(),d.get().then(g(a),g(b))}},a[h]),d.get({},c.option&&c.option.skipCache)})}]).directive("ngRestfulCollection",function(){return{restrict:"A",controller:"ngRestfulCollectionCtrl"}})}(window,angular);
//# sourceMappingURL=ng-restful-collection.min.map